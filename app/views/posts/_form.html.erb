<%= form_with model: post, local: true do |f| %>
  <%# エラーメッセージ表示 %>
  <%= render 'shared/error_messages', object: f.object %>
  <!-- 投稿タイプ選択 -->
  <div class="mb-3">
    <%= f.label :post_type, "投稿タイプ", class: "form-label fw-bold" %>
    <%# 書籍 %>
    <div class="d-flex gap-4 mt-1">
      <div class="form-check form-switch">
        <%= f.radio_button :post_type, 'book', 
                            id: 'post_type_book', 
                            class: 'form-check-input' %>
        <%= f.label :post_type_book, "書籍", class: "form-check-label" %>
      </div>
      <%# 動画 %>
      <div class="form-check form-switch">
        <%= f.radio_button :post_type, 'video', 
                            id: 'post_type_video', 
                            class: 'form-check-input' %>
        <%= f.label :post_type_video, "動画", class: "form-check-label" %>
      </div>
    </div>
  </div>
  <!-- タイトル -->
  <div class="form-input mb-3">
    <%= f.label :title, "タイトル", class: "form-label" %>
    <%= f.text_field :title, class: "form-control" %>
  </div>
  <!-- 画像アップロード（書籍用）-->
  <div class="mb-3">
    <%= f.label :image, "画像", class: "form-label field-label" %>
    <%= f.file_field :image, 
                      class: "form-control", 
                      id: "image-input",
                      accept: 'image/*' %>
    <!-- 編集時にサムネイルを表示 -->
    <% if post.persisted? && post.image.present? %>
      <div class="mt-5">
        <%= image_tag url_for(post.image), 
                      class: "img-thumbnail", 
                      style: "max-width: 200px;" %>
      </div>
      <small class="text-muted">
        JPEG, JPG, PNG, GIF形式のファイルをアップロードできます（最大5MB）
      </small>
    <% end %>
  </div>
  <!-- YouTube URL -->
  <%= f.label :video_url, "YouTube URL", class: "form-label" %>
  <%= f.url_field :video_url,
                  class: "form-control mb-4", 
                  id: "youtube-input",
                  placeholder: "https://www.youtube.com/watch?v=..." %>
    <!-- 編集画面で現在のサムネイルを表示 -->
  <% if post.persisted? && post.post_type == 'video' && post.video_url.present? %>
    <div class="mt-2">
      <% thumbnail_url = post.youtube_thumbnail_url %>
      <% if thumbnail_url %>
        <%= image_tag thumbnail_url, 
                      class: "youtube-thumbnail", 
                      alt: "YouTube動画サムネイル",
                      style: "max-width: 200px;",
                      data: {fallback_target: 'youtube-error-message' } %>
        <%# サムネイル読み込みエラー時 %>
        <div class="youtube-error-message alert alert-warning" style="display: none;">
          <i class="fas fa-exclamation-triangle me-2"></i>
          サムネイルを読み込めませんでした
        </div>
      <% else %>
        <%# 無効なURLの時 %>
        <div class="alert alert-warning">
          <i class="fas fa-info-circle me-2"></i>
          有効なYouTube URLを入力してください
        </div>
      <% end %>
    </div>
  <% end %>
  <!-- カテゴリ -->
  <div class="mt-3 mb-3">
    <%= f.label :category, "カテゴリ", class: "form-label" %>
    <%= f.select :category, 
                {'スキャルピング': 'scalping', 'デイトレ': 'day', 'スウィング': 'swing'}, 
                { include_blank: "選択してください" },
                { class: "form-select form-control" } %>
  </div>
  <!-- レビュー内容 -->
  <div class="mb-3">
    <%= f.label :review_text, "感想", class: "form-label" %>
    <%= f.text_area :review_text,
                    rows: 10, 
                    class: "form-control",
                    placeholder: "感想やレビューを入力してください..." %>
  </div>
  <!-- 送信ボタン -->
  <div class="d-grid gap-2 d-md-flex justify-content-center">
    <%= f.submit post.persisted? ? "更新する" : "投稿する", 
                class: "btn btn-primary me-2" %>
    <%= link_to "キャンセル", 
                post.persisted? ? post_path(post) : posts_path, 
                class: "btn btn-secondary" %>
  </div>
<% end %>
